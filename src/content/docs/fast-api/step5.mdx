---
title: '5: Todoã®èª­ã¿å–ã‚Š'
pubDate: 2025-06-09
description: 'FastAPI ã®åˆå¿ƒè€…å‘ã‘ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã™'
author: 'Nabe847'
image:
  url: 'https://docs.astro.build/assets/full-logo-light.png'
  alt: 'FastAPIã®ãƒ­ã‚´ã€‚'
tags: ['FastAPI', 'tutorial']
---

## ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å­¦ã¶ã“ã¨

ä»Šå›ã¯Todoã®èª­ã¿å–ã‚Š(å–å¾—)æ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã™ã€‚  
APIã‚’é€šã˜ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰Todoã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

## Todoå–å¾—æ©Ÿèƒ½ã®å®Ÿè£…

`app/main.py` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ã€Todoã®èª­ã¿å–ã‚Šæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™:

```diff lang=python
from fastapi import FastAPI, Depends, HTTPException
from sqlalchemy.orm import Session
from . import models, schemas
from .database import engine, get_db

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
models.Base.metadata.create_all(bind=engine)

app = FastAPI()

+# 1. Todoã®ä¸€è¦§å–å¾—
+@app.get("/todos/", response_model=list[schemas.Todo])
+def read_todos(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):
+    todos = db.query(models.Todo).offset(skip).limit(limit).all()
+    return todos
+
+# 2. ç‰¹å®šã®Todoã®å–å¾—
+@app.get("/todos/{todo_id}", response_model=schemas.Todo)
+def read_todo(todo_id: int, db: Session = Depends(get_db)):
+    db_todo = db.query(models.Todo).filter(models.Todo.id == todo_id).first()
+    
+    # TodoãŒå­˜åœ¨ã—ãªã„å ´åˆã¯404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
+    if db_todo is None:
+        raise HTTPException(status_code=404, detail="Todo not found")
+    
+    return db_todo

# Todoã®ä½œæˆ
@app.post("/todos/", response_model=schemas.Todo)
def create_todo(todo: schemas.TodoCreate, db: Session = Depends(get_db)):
    # 1. æ–°ã—ã„Todoã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ
    db_todo = models.Todo(title=todo.title)

    # 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¿½åŠ 
    db.add(db_todo)

    # 3. å¤‰æ›´ã‚’ä¿å­˜
    db.commit()

    # 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    db.refresh(db_todo)

    # 5. ä½œæˆã—ãŸTodoã‚’è¿”ã™
    return db_todo
```

## ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

1. **Todoã®ä¸€è¦§å–å¾—**

   ```python
   @app.get("/todos/", response_model=list[schemas.Todo])
   def read_todos(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):
       todos = db.query(models.Todo).offset(skip).limit(limit).all()
       return todos
   ```

   - `@app.get("/todos/")`: GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã—ã¾ã™
   - `response_model=list[schemas.Todo]`: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å½¢å¼ã‚’æŒ‡å®šã—ã¾ã™
   - `skip`ã¨`limit`: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™
   - `db.query(models.Todo)`: Todoãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã™ã‚‹ã‚¯ã‚¨ãƒªã‚’ä½œæˆã—ã¾ã™
   - `offset(skip).limit(limit)`: æŒ‡å®šã•ã‚ŒãŸç¯„å›²ã®Todoã‚’å–å¾—ã—ã¾ã™
   - `all()`: ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦çµæœã‚’å–å¾—ã—ã¾ã™

2. **ç‰¹å®šã®Todoã®å–å¾—**

   ```python
   @app.get("/todos/{todo_id}", response_model=schemas.Todo)
   def read_todo(todo_id: int, db: Session = Depends(get_db)):
       db_todo = db.query(models.Todo).filter(models.Todo.id == todo_id).first()
       if db_todo is None:
           raise HTTPException(status_code=404, detail="Todo not found")
       return db_todo
   ```

   - `@app.get("/todos/{todo_id}")`: ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã—ã¾ã™
   - `todo_id: int`: ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ•´æ•°å‹ã¨ã—ã¦å—ã‘å–ã‚Šã¾ã™
   - `filter(models.Todo.id == todo_id)`: æŒ‡å®šã•ã‚ŒãŸIDã®Todoã‚’æ¤œç´¢ã—ã¾ã™
   - `first()`: æœ€åˆã®çµæœã‚’å–å¾—ã—ã¾ã™
   - `HTTPException`: ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™

## ğŸš€ å‹•ä½œç¢ºèª

1. ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™:

```bash
uvicorn app.main:app --reload
```

2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:8000/docs` ã‚’é–‹ãã¾ã™ã€‚

3. ä»¥ä¸‹ã®æ“ä½œã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†:

- Todoã®ä¸€è¦§å–å¾—ï¼ˆGET /todos/ï¼‰
- ç‰¹å®šã®Todoã®å–å¾—ï¼ˆGET `/todos/{todo_id}`ï¼‰

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

**404ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ**

- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹: `{"detail": "Todo not found"}`
- è§£æ±ºæ–¹æ³•:
  1. æŒ‡å®šã—ãŸIDã®TodoãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
  2. æ­£ã—ã„IDã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã‹ç¢ºèª

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ**

- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹: `sqlalchemy.exc.OperationalError`
- è§£æ±ºæ–¹æ³•:
  1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
  2. ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª

## ğŸ¯ ç†è§£åº¦ãƒã‚§ãƒƒã‚¯

ä»¥ä¸‹ã®è³ªå•ã«ç­”ãˆã¦ã€å­¦ç¿’å†…å®¹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼

1. **FastAPIã§ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å®šç¾©ã™ã‚‹éš›ã®æ­£ã—ã„æ›¸ãæ–¹ã¯ï¼Ÿ**

   - A: `@app.get("/todos/{todo_id}")`
   - B: `@app.get("/todos/:todo_id")`
   - C: `@app.get("/todos/todo_id")`

<details>
<summary>ç­”ãˆã‚’è¦‹ã‚‹</summary>

   **ç­”ãˆ: A: `@app.get("/todos/{todo_id}")`**

   - FastAPIã§ã¯ã€ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’`{ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å}`ã®å½¢å¼ã§å®šç¾©ã—ã¾ã™
   - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã¯é–¢æ•°ã®å¼•æ•°åã¨ä¸€è‡´ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
   - å‚è€ƒ: [FastAPIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://fastapi.tiangolo.com/tutorial/path-params/)
</details>

## ğŸ“ ã¾ã¨ã‚

ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ä»¥ä¸‹ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸã€‚

- **èª­ã¿å–ã‚Šæ©Ÿèƒ½ã®å®Ÿè£…**
  - ä¸€è¦§å–å¾—æ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•
  - å€‹åˆ¥å–å¾—æ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•
- **APIã®è¨­è¨ˆ**
  - ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä½¿ã„æ–¹
  - ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä½¿ã„æ–¹
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã®æŒ‡å®šæ–¹æ³•

--- 