---
title: '2: 環境構築'
pubDate: 2024-03-20
description: 'FastAPI の環境構築を行います'
author: 'Nabe847'
image:
  url: 'https://docs.astro.build/assets/full-logo-light.png'
  alt: 'FastAPIのロゴ。'
tags: ['FastAPI', 'tutorial']
---

## プロジェクトの作成

まず、プロジェクト用のフォルダを作成し、必要なパッケージをインストールしていきましょう。

1. ターミナルで以下のコマンドを実行して、プロジェクトフォルダを作成します：

```bash
mkdir todo-api
cd todo-api
```

2. 仮想環境を作成して有効化します：

```bash
# 仮想環境の作成
python -m venv venv

# 仮想環境の有効化
# Windows の場合
venv\Scripts\activate
# Mac/Linux の場合
source venv/bin/activate
```

> 💡 **仮想環境**: プロジェクトごとに独立した Python の環境を作るための機能です。これにより、異なるプロジェクトで異なるバージョンのパッケージを使用できます。

3. 必要なパッケージをインストールします：

```bash
pip install fastapi uvicorn sqlalchemy
```

> 💡 **パッケージ**: 追加の機能を提供するプログラムです。以下のパッケージをインストールしました：
> - `fastapi`: Web API を作るためのフレームワーク
> - `uvicorn`: Web サーバー
> - `sqlalchemy`: データベースを操作するためのライブラリ

4. プロジェクトの基本構造を作成します：

```bash
mkdir app
touch app/__init__.py
touch app/main.py
touch app/database.py
touch app/models.py
```

これで以下のような構造が作成されます：

```
todo-api/
├── venv/              # 仮想環境（編集不要）
├── app/               # アプリケーションのコード
│   ├── __init__.py    # Python パッケージとして認識するためのファイル
│   ├── main.py        # メインのアプリケーションコード
│   ├── database.py    # データベースの設定
│   └── models.py      # データベースのモデル定義
└── requirements.txt   # 必要なパッケージの一覧
```

5. インストールしたパッケージの一覧を保存します：

```bash
pip freeze > requirements.txt
```

## 最初のAPIを作成

それでは、最初のAPIを作成してみましょう。`app/main.py` を以下のように編集します：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
def read_root():
    return {"message": "Hello World"}
```

## サーバーの起動

APIを起動するには、以下のコマンドを実行します：

```bash
uvicorn app.main:app --reload
```

以下のような出力が表示されれば成功です：

```
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

ブラウザで `http://127.0.0.1:8000` を開くと、以下のようなJSONが表示されます：

```json
{
  "message": "Hello World"
}
```

また、`http://127.0.0.1:8000/docs` にアクセスすると、自動生成されたAPIドキュメントを確認できます。

## よくある問題と解決方法

**コマンドが見つからない場合**

- エラーメッセージ例：`'python' は内部コマンドまたは外部コマンドとして認識されていません`
- 解決方法：
  1. Python が正しくインストールされているか確認
  2. パソコンを再起動してみる
  3. Python を再インストールする

**仮想環境の有効化に失敗する場合**

- エラーメッセージ例：`venv\Scripts\activate : このシステムではスクリプトを実行できないため...`
- 解決方法：
  1. PowerShell のセキュリティ設定を変更する
  2. コマンドプロンプトを使用する
  3. `Set-ExecutionPolicy RemoteSigned -Scope CurrentUser` を実行する

**ポートが使用中の場合**

- 別のアプリケーションが 8000 番ポートを使用している場合、以下のように別のポートを指定できます：
```bash
uvicorn app.main:app --reload --port 8001
```

## 次のステップ

これで環境構築は完了です。次のステップでは、データベースの設定を行います。 