---
title: '6: Todoã®æ›´æ–°'
pubDate: 2025-06-09
description: 'FastAPI ã®åˆå¿ƒè€…å‘ã‘ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã™'
author: 'Nabe847'
image:
  url: 'https://docs.astro.build/assets/full-logo-light.png'
  alt: 'FastAPIã®ãƒ­ã‚´ã€‚'
tags: ['FastAPI', 'tutorial']
---

## ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å­¦ã¶ã“ã¨

ä»Šå›ã¯Todoã®æ›´æ–°æ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã™ã€‚  
APIã‚’é€šã˜ã¦Todoã‚’ç·¨é›†ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

## Todoæ›´æ–°æ©Ÿèƒ½ã®ä½œæˆ

`todo-api/app/main.py` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦Todoã®æ›´æ–°æ©Ÿèƒ½ã‚’ä½œæˆã—ã¾ã™:

```diff lang=python
# todo-api/app/main.py
from fastapi import FastAPI, Depends, HTTPException
from sqlalchemy.orm import Session
from . import models, schemas
from .database import engine, get_db

models.Base.metadata.create_all(bind=engine)

app = FastAPI()

# Todoã®ä¸€è¦§å–å¾—
@app.get("/todos/", response_model=list[schemas.Todo])
def read_todos(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):
    todos = db.query(models.Todo).offset(skip).limit(limit).all()
    return todos

# ç‰¹å®šã®Todoã®å–å¾—
@app.get("/todos/{todo_id}", response_model=schemas.Todo)
def read_todo(todo_id: int, db: Session = Depends(get_db)):
    db_todo = db.query(models.Todo).filter(models.Todo.id == todo_id).first()

    # TodoãŒå­˜åœ¨ã—ãªã„å ´åˆã¯404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
    if db_todo is None:
        raise HTTPException(status_code=404, detail="Todo not found")

    return db_todo

# Todoã®ä½œæˆ
@app.post("/todos/", response_model=schemas.Todo)
def create_todo(todo: schemas.TodoCreate, db: Session = Depends(get_db)):
    # 1. æ–°ã—ã„Todoã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ
    db_todo = models.Todo(title=todo.title)

    # 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¿½åŠ 
    db.add(db_todo)

    # 3. å¤‰æ›´ã‚’ä¿å­˜
    db.commit()

    # 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    db.refresh(db_todo)

    # 5. ä½œæˆã—ãŸTodoã‚’è¿”ã™
    return db_todo

+# 1. Todoã®æ›´æ–°
+@app.put("/todos/{todo_id}", response_model=schemas.Todo)
+def update_todo(todo_id: int, todo: schemas.TodoCreate, db: Session = Depends(get_db)):
+    # æŒ‡å®šã•ã‚ŒãŸIDã®Todoã‚’å–å¾—
+    db_todo = db.query(models.Todo).filter(models.Todo.id == todo_id).first()
+    
+    # TodoãŒå­˜åœ¨ã—ãªã„å ´åˆã¯404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
+    if db_todo is None:
+        raise HTTPException(status_code=404, detail="Todo not found")
+    
+    # Todoã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
+    db_todo.title = todo.title
+    
+    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ã‚’ä¿å­˜
+    db.commit()
+    db.refresh(db_todo)
+    
+    return db_todo

+# 2. Todoã®å®Œäº†çŠ¶æ…‹ã®æ›´æ–°
+@app.patch("/todos/{todo_id}/complete", response_model=schemas.Todo)
+def complete_todo(todo_id: int, db: Session = Depends(get_db)):
+    # æŒ‡å®šã•ã‚ŒãŸIDã®Todoã‚’å–å¾—
+    db_todo = db.query(models.Todo).filter(models.Todo.id == todo_id).first()
+    
+    # TodoãŒå­˜åœ¨ã—ãªã„å ´åˆã¯404ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
+    if db_todo is None:
+        raise HTTPException(status_code=404, detail="Todo not found")
+    
+    # Todoã®å®Œäº†çŠ¶æ…‹ã‚’æ›´æ–°
+    db_todo.completed = True
+    
+    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ã‚’ä¿å­˜
+    db.commit()
+    db.refresh(db_todo)
+    
+    return db_todo
```

## ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

1. **Todoã®æ›´æ–°**

   ```python
   @app.put("/todos/{todo_id}", response_model=schemas.Todo)
   def update_todo(todo_id: int, todo: schemas.TodoCreate, db: Session = Depends(get_db)):
       db_todo = db.query(models.Todo).filter(models.Todo.id == todo_id).first()
       if db_todo is None:
           raise HTTPException(status_code=404, detail="Todo not found")
       db_todo.title = todo.title
       db.commit()
       db.refresh(db_todo)
       return db_todo
   ```

   - `@app.put("/todos/{todo_id}")`: PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã—ã¾ã™
   - `todo: schemas.TodoCreate`: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®å½¢å¼ã‚’æŒ‡å®šã—ã¾ã™
   - `db_todo.title = todo.title`: Todoã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°ã—ã¾ã™
   - `db.commit()`: å¤‰æ›´ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã—ã¾ã™
   - `db.refresh(db_todo)`: æ›´æ–°å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ã¾ã™

2. **Todoã®å®Œäº†çŠ¶æ…‹ã®æ›´æ–°**

   ```python
   @app.patch("/todos/{todo_id}/complete", response_model=schemas.Todo)
   def complete_todo(todo_id: int, db: Session = Depends(get_db)):
       db_todo = db.query(models.Todo).filter(models.Todo.id == todo_id).first()
       if db_todo is None:
           raise HTTPException(status_code=404, detail="Todo not found")
       db_todo.completed = True
       db.commit()
       db.refresh(db_todo)
       return db_todo
   ```

   - `@app.patch("/todos/{todo_id}/complete")`: PATCHãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã—ã¾ã™
   - `db_todo.completed = True`: Todoã®å®Œäº†çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¾ã™
   - `db.commit()`: å¤‰æ›´ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã—ã¾ã™
   - `db.refresh(db_todo)`: æ›´æ–°å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã—ã¾ã™

## ğŸš€ å‹•ä½œç¢ºèª

1. ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™:

    ```bash
    uvicorn app.main:app --reload
    ```

2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:8000/docs` ã‚’é–‹ãã¾ã™ã€‚

3. ä»¥ä¸‹ã®æ“ä½œã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†:

    - Todoã®æ›´æ–°ï¼ˆPUT `/todos/{todo_id}`ï¼‰
        ```json
        {
          "title": "å‰Šé™¤æ©Ÿèƒ½ã‚’ä½œã‚‹"
        }
        ```
    - Todoã®å®Œäº†ï¼ˆPATCH `/todos/{todo_id}/complete`ï¼‰

## ğŸ¯ ç†è§£åº¦ãƒã‚§ãƒƒã‚¯

ä»¥ä¸‹ã®è³ªå•ã«ç­”ãˆã¦ã€å­¦ç¿’å†…å®¹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼

1. **FastAPIã§PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã™ã‚‹éš›ã®æ­£ã—ã„æ›¸ãæ–¹ã¯ï¼Ÿ**

   - A: `@app.put("/todos/{todo_id}")`
   - B: `@app.post("/todos/{todo_id}")`
   - C: `@app.get("/todos/{todo_id}")`

<details>
<summary>ç­”ãˆã‚’è¦‹ã‚‹</summary>

   **ç­”ãˆ: A: `@app.put("/todos/{todo_id}")`**

   - PUTã¯ãƒªã‚½ãƒ¼ã‚¹ã®æ›´æ–°ã«ä½¿ã‚ã‚Œã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰ã§ã™
   - FastAPIã§ã¯`@app.put()`ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã—ã¾ã™
   - å‚è€ƒ: [FastAPIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://fastapi.tiangolo.com/tutorial/body-updates/)
</details>

## ğŸ“ ã¾ã¨ã‚

ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ä»¥ä¸‹ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸã€‚

- **æ›´æ–°æ©Ÿèƒ½ã®ä½œæˆ**
  - æ›´æ–°æ©Ÿèƒ½
  - éƒ¨åˆ†æ›´æ–°æ©Ÿèƒ½

--- 
