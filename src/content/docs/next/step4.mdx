---
title: '4: タスクの追加(Create)'
pubDate: 2025-06-10
description: 'Next.js の初心者向けチュートリアルです'
author: 'Nabe847'
image:
  url: 'https://docs.astro.build/assets/full-logo-light.png'
  alt: 'Astroのロゴ。'
tags: ['Next.js', 'tutorial']
---

import { Steps } from '@astrojs/starlight/components';

## このステップで学ぶこと

前回のタスク表示機能に続いて、今回はタスクの追加機能を実装していきます。

まず、フォームの基本的な使い方と状態管理について学びます：
- フォームの値は状態で管理する
- 入力値の変更を検知して状態を更新する
- フォーム送信時に新しいタスクを追加する
- Enterキーでのタスク追加
- 入力値のバリデーション

### app/page.js を更新

タスク追加機能を実装します：

```javascript
'use client';
import { useState } from 'react';

export default function Home() {
  // 1. 状態の定義
  const [tasks, setTasks] = useState([
    { id: 1, title: '買い物に行く', completed: false },
    { id: 2, title: '宿題をする', completed: true },
    { id: 3, title: '友達に連絡する', completed: false },
  ]);
  const [newTaskTitle, setNewTaskTitle] = useState('');

  // 2. タスク追加の処理
  const handleAddTask = (e) => {
    e.preventDefault();
    if (!newTaskTitle.trim()) {
      alert('タスクタイトルを入力してください');
      return;
    }

    const newTask = {
      id: Date.now(), // 簡単なID生成（現在時刻を使用）
      title: newTaskTitle,
      completed: false,
    };

    setTasks([...tasks, newTask]);
    setNewTaskTitle('');
  };

  return (
    <div style={{ padding: '20px', maxWidth: '600px', margin: '0 auto' }}>
      <h1>タスク管理アプリ</h1>

      {/* 3. タスク追加フォーム */}
      <form onSubmit={handleAddTask} style={{ marginBottom: '20px' }}>
        <input
          type="text"
          value={newTaskTitle}
          onChange={(e) => setNewTaskTitle(e.target.value)}
          placeholder="新しいタスクを入力"
          style={{
            padding: '8px',
            width: '70%',
            marginRight: '10px',
            border: '1px solid #ccc',
            borderRadius: '4px',
          }}
          onKeyPress={(e) => {
            if (e.key === 'Enter') {
              handleAddTask(e);
            }
          }}
        />
        <button
          type="submit"
          style={{
            padding: '8px 16px',
            backgroundColor: '#4CAF50',
            color: 'white',
            border: 'none',
            borderRadius: '4px',
            cursor: 'pointer',
          }}
        >
          追加
        </button>
      </form>

      {/* 4. タスク一覧の表示 */}
      <div>
        <h2>タスク一覧 ({tasks.length}件)</h2>
        {tasks.map((task) => (
          <div
            key={task.id}
            style={{
              border: '1px solid #ccc',
              padding: '15px',
              margin: '10px 0',
              backgroundColor: task.completed ? '#f0f8f0' : '#fff',
              borderRadius: '4px',
            }}
          >
            <span
              style={{
                textDecoration: task.completed ? 'line-through' : 'none',
                fontSize: '16px',
              }}
            >
              {task.title}
            </span>
            <span
              style={{ marginLeft: '10px', fontSize: '12px', color: '#666' }}
            >
              {task.completed ? '完了' : '未完了'}
            </span>

            <div style={{ marginTop: '10px' }}>
              <button
                style={{
                  marginRight: '5px',
                  padding: '4px 8px',
                  fontSize: '12px',
                  backgroundColor: task.completed ? '#ffc107' : '#28a745',
                  color: 'white',
                  border: 'none',
                  borderRadius: '3px',
                  cursor: 'pointer',
                }}
              >
                {task.completed ? '未完了にする' : '完了にする'}
              </button>
              <button
                style={{
                  padding: '4px 8px',
                  fontSize: '12px',
                  backgroundColor: '#dc3545',
                  color: 'white',
                  border: 'none',
                  borderRadius: '3px',
                  cursor: 'pointer',
                }}
              >
                削除
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

### コードの解説

<Steps>

1. **状態の定義**

   ```javascript
   const [tasks, setTasks] = useState([
     { id: 1, title: '買い物に行く', completed: false },
     { id: 2, title: '宿題をする', completed: true },
     { id: 3, title: '友達に連絡する', completed: false },
   ]);
   const [newTaskTitle, setNewTaskTitle] = useState('');
   ```

   > 💡 **状態管理について**
   > - 状態とは、コンポーネントが保持するデータのことです
   > - `useState`は状態の値と、それを更新する関数のペアを返します
   > - 状態が更新されると、Reactは自動的に画面を更新します
   > - この例では2つの状態を管理しています：
   >   1. `tasks`: タスクの配列（初期値として3つのタスクを設定）
   >   2. `newTaskTitle`: 新規タスクの入力値（初期値は空文字列）
   >
   > より詳しく知りたい方は、[https://ja.react.dev/learn/state-a-components-memory](https://ja.react.dev/learn/state-a-components-memory) を参考にしてください。

2. **タスク追加の処理**

   ```javascript
   const handleAddTask = (e) => {
     e.preventDefault();
     if (!newTaskTitle.trim()) {
       alert('タスクタイトルを入力してください');
       return;
     }

     const newTask = {
       id: Date.now(), // 簡単なID生成（現在時刻を使用）
       title: newTaskTitle,
       completed: false,
     };

     setTasks([...tasks, newTask]);
     setNewTaskTitle('');
   };
   ```

   > 💡 **タスク追加の処理について**
   > - `e.preventDefault()`: フォームのデフォルトの送信動作を防止
   > - `newTaskTitle.trim()`: 入力値の前後の空白を削除してチェック
   > - `Date.now()`: 現在のタイムスタンプをIDとして使用（一意の値）
   > - `[...tasks, newTask]`: スプレッド演算子を使用して既存のタスク配列に新しいタスクを追加
   > - `setNewTaskTitle('')`: 入力フィールドをクリア

3. **フォームの実装**

   ```javascript
   <form onSubmit={handleAddTask} style={{ marginBottom: '20px' }}>
     <input
       type="text"
       value={newTaskTitle}
       onChange={(e) => setNewTaskTitle(e.target.value)}
       placeholder="新しいタスクを入力"
       style={{
         padding: '8px',
         width: '70%',
         marginRight: '10px',
         border: '1px solid #ccc',
         borderRadius: '4px',
       }}
       onKeyPress={(e) => {
         if (e.key === 'Enter') {
           handleAddTask(e);
         }
       }}
     />
     <button type="submit">追加</button>
   </form>
   ```

   > 💡 **フォームの実装について**
   > - `onSubmit`: フォーム送信時のイベントハンドラ
   > - `value={newTaskTitle}`: 入力フィールドの値を状態と同期
   > - `onChange`: 入力値が変更された時のイベントハンドラ
   > - `onKeyPress`: Enterキーが押された時のイベントハンドラ
   > - スタイリングはインラインで実装（後ほどCSSモジュールやTailwind CSSなどで改善可能）

4. **タスク一覧の表示**

   ```javascript
   <div>
     <h2>タスク一覧 ({tasks.length}件)</h2>
     {tasks.map((task) => (
       <div key={task.id}>
         <span>{task.title}</span>
         <span>{task.completed ? '完了' : '未完了'}</span>
         <div>
           <button>{task.completed ? '未完了にする' : '完了にする'}</button>
           <button>削除</button>
         </div>
       </div>
     ))}
   </div>
   ```

   > 💡 **タスク一覧の表示について**
   > - `tasks.map()`: 配列の各要素に対して処理を実行
   > - `key={task.id}`: Reactのリスト表示で必要な一意のキー
   > - 条件付きレンダリング: `task.completed ? '完了' : '未完了'`
   > - スタイリング: 完了状態に応じて背景色やテキストの装飾を変更

5. **フォームのイベントハンドリング**

   ```javascript
   <form onSubmit={handleAddTask}>
     <input
       onChange={(e) => setNewTaskTitle(e.target.value)}
       onKeyPress={(e) => {
         if (e.key === 'Enter') {
           handleAddTask(e);
         }
       }}
     />
   </form>
   ```

   > 💡 **フォームのイベントハンドリングについて**
   > - `onSubmit`: フォーム送信時のイベントハンドラ
   >   - `e.preventDefault()`でデフォルトの送信動作を防止
   >   - 入力値のバリデーションを実行
   >   - 新しいタスクを追加
   > 
   > - `onChange`: 入力値変更時のイベントハンドラ
   >   - `e.target.value`で入力フィールドの現在の値を取得
   >   - `setNewTaskTitle`で状態を更新
   > 
   > - `onKeyPress`: Enterキー押下時のイベントハンドラ
   >   - `e.key === 'Enter'`でEnterキーの押下を検知
   >   - Enterキー押下時も`handleAddTask`を実行
   >
   > より詳しく知りたい方は、[MDNのイベントハンドリングの解説](https://developer.mozilla.org/ja/docs/Learn/JavaScript/Building_blocks/Events)を参考にしてください。

</Steps>

### よくある問題と解決方法

**タスクが追加されない場合**
- `useState` が正しくインポートされているか確認
- フォームの送信イベントが正しく処理されているか確認
- コンソールにエラーが表示されていないか確認

**入力フィールドが更新されない場合**
- `onChange` イベントハンドラが正しく設定されているか確認
- 状態の更新関数が正しく呼び出されているか確認

### 🔍 動作確認

実装した機能が正しく動作するか確認してみましょう：

import ChecklistItem from '../../../components/ChecklistItem.jsx';

<div>
  <ChecklistItem client:load id="step4-point1">
    新しいタスクを入力できる
  </ChecklistItem>
  <ChecklistItem client:load id="step4-point2">
    追加ボタンをクリックするとタスクが追加される
  </ChecklistItem>
  <ChecklistItem client:load id="step4-point3">
    タスク追加後に入力フィールドがクリアされる
  </ChecklistItem>
  <ChecklistItem client:load id="step4-point4">
    空のタスクは追加されない
  </ChecklistItem>
  <ChecklistItem client:load id="step4-point5">
    Enterキーでもタスクが追加される
  </ChecklistItem>
  <ChecklistItem client:load id="step4-point6">
    タスク件数が正しく表示される
  </ChecklistItem>
</div>

### 🎯 理解度チェッククイズ

以下の質問に答えて、学習内容を確認しましょう！

1. **Reactで状態を管理するために使用するフックは？**

   - A: `useEffect`
   - B: `useState`
   - C: `useContext`
   - D: `useReducer`

   <details>
   <summary>答えを見る</summary>

   **答え: B: `useState`**
   - `useState` はコンポーネント内で状態を管理するための基本的なフックです
   - 状態の値と、それを更新する関数のペアを返します
   </details>

2. **フォームの送信を防止するために使用するメソッドは？**

   - A: `stopPropagation()`
   - B: `preventDefault()`
   - C: `stopImmediatePropagation()`
   - D: `cancelBubble()`

   <details>
   <summary>答えを見る</summary>

   **答え: B: `preventDefault()`**
   - `preventDefault()` はイベントのデフォルトの動作を防止します
   - フォームの送信時には、ページのリロードを防ぐために使用します
   </details>

3. **入力フィールドの値が変更された時に発生するイベントは？**

   - A: `onClick`
   - B: `onChange`
   - C: `onSubmit`
   - D: `onInput`

   <details>
   <summary>答えを見る</summary>

   **答え: B: `onChange`**
   - `onChange` イベントは、入力フィールドの値が変更されるたびに発生します
   - フォームの制御には、このイベントを使用して状態を更新します
   </details>

--- 