---
title: '7: Todoの完了状態の更新'
pubDate: 2025-06-09
description: 'Next.js の初心者向けチュートリアルです'
author: 'Nabe847'
image:
  url: 'https://docs.astro.build/assets/full-logo-light.png'
  alt: 'Astroのロゴ。'
tags: ['Next.js', 'tutorial']
---

## このステップで学ぶこと

前回はTodoの追加機能を実装しました。  
今回はTodoの完了状態を更新する機能を実装していきましょう。

1. **状態の更新方法**
2. **イベントハンドリング**
3. **条件付きレンダリング**

> 💡 **ヒント**:  
> Webアプリケーションでは、ユーザーの操作に応じて状態を更新することが重要です。  
> このステップでは、チェックボックスの状態に応じてTodoの完了状態を更新する方法を学びます。

## Todoの完了状態更新機能の実装

`src/app/todos/page.js` を以下の内容に更新します。

```javascript
'use client';
import { useState } from 'react';
import style from './page.module.css';

export default function Todos() {
  // Todoデータの定義
  const [tasks, setTasks] = useState([
    { id: 1, title: '買い物に行く', completed: false },
    { id: 2, title: 'メールを確認する', completed: false },
    { id: 3, title: '資料を作成する', completed: false },
    { id: 4, title: '友達に電話する', completed: false },
    { id: 5, title: '部屋の掃除', completed: false },
  ]);

  // 入力値の状態管理
  const [newTask, setNewTask] = useState('');

  // Todo追加処理
  const handleSubmit = (e) => {
    e.preventDefault();
    if (newTask.trim() === '') return;

    const newId = tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1;
    setTasks([...tasks, { id: newId, title: newTask, completed: false }]);
    setNewTask('');
  };

  // Todoの完了状態を更新する処理
  const handleToggleComplete = (taskId) => {
    setTasks(tasks.map(task =>
      task.id === taskId
        ? { ...task, completed: !task.completed }
        : task
    ));
  };

  return (
    <section className={style.container}>
      <h1>Todoリスト</h1>
      
      {/* Todo追加フォーム */}
      <form onSubmit={handleSubmit} className={style.form}>
        <input
          type="text"
          value={newTask}
          onChange={(e) => setNewTask(e.target.value)}
          placeholder="新しいTodoを入力"
          className={style.input}
        />
        <button type="submit" className={style.button}>追加</button>
      </form>

      {/* Todo一覧 */}
      <div className={style.checkbox}>
        {tasks.map(task => (
          <div key={task.id}>
            <label className={task.completed ? style.completed : ''}>
              <input
                type="checkbox"
                checked={task.completed}
                onChange={() => handleToggleComplete(task.id)}
              />
              {task.title}
            </label>
          </div>
        ))}
      </div>
    </section>
  );
}
```

### コードの説明

1. **状態管理の基本**
   - `useState` フックを使って、データを保存する場所（状態）を作ります
   - `tasks`: Todo一覧を保存する配列
   - `newTask`: 入力フォームの文字を保存する変数

2. **Todoの完了状態を更新する仕組み**
   ```javascript
   const handleToggleComplete = (taskId) => {
     setTasks(tasks.map(task =>
       task.id === taskId
         ? { ...task, completed: !task.completed }
         : task
     ));
   };
   ```
   - `map()`: 配列の各要素に対して、同じ処理を行います
   - `task.id === taskId`: クリックされたTodoを見つけます
   - `{ ...task, completed: !task.completed }`: Todoの完了状態を反転させます
   - `setTasks()`: 更新されたTodo一覧を保存します

3. **チェックボックスの基本**
   - `checked`: チェックボックスの状態（チェックされているかどうか）を指定します
   - `onChange`: チェックボックスがクリックされたときの処理を指定します
   - `className={task.completed ? style.completed : ''}`: Todoが完了しているかどうかで、見た目を変えます

## スタイルの更新

`src/app/todos/page.module.css` に以下のスタイルを追加します。

```css
.completed {
  text-decoration: line-through;
  color: #888;
}
```

### スタイルの説明

1. **完了Todoのスタイル**
   - `text-decoration: line-through`: 取り消し線を表示
   - `color: #888`: グレーアウトして視覚的に区別

## 🔍 確認

実装した機能が正しく動作しているか確認しましょう：

import ChecklistItem from '../../../components/ChecklistItem.jsx';

<div>
  <ChecklistItem client:load id="step7-point1">
    チェックボックスをクリックするとTodoの完了状態が切り替わる
  </ChecklistItem>
  <ChecklistItem client:load id="step7-point2">
    完了したTodoの見た目が変わる
  </ChecklistItem>
  <ChecklistItem client:load id="step7-point3">
    完了状態が正しく保持される
  </ChecklistItem>
</div>

## よくある問題と解決方法

**状態が更新されない**
- `handleToggleComplete` 関数が正しく呼び出されているか確認
- 状態更新関数が正しく実装されているか確認

**スタイルが適用されない**
- CSSクラス名が正しく設定されているか確認
- 条件付きクラス名の指定が正しいか確認

## 🎯 理解度チェック

以下の質問に答えて、学習内容を確認しましょう！

1. **配列の各要素を条件に応じて更新するメソッドは？**

   - A: `forEach()`
   - B: `map()`
   - C: `filter()`
   - D: `reduce()`

<details>
<summary>答えを見る</summary>

   **答え: B: `map()`**
   - `map()` は配列の各要素に対して処理を行い、新しい配列を作成します
   - このステップでは、特定のTodoの完了状態を更新するために使用しています
</details>

2. **オブジェクトのプロパティを更新する際に使用する演算子は？**

   - A: `+`
   - B: `...`
   - C: `&&`
   - D: `||`

<details>
<summary>答えを見る</summary>

   **答え: B: `...`**
   - スプレッド演算子（`...`）は、オブジェクトのプロパティを展開して新しいオブジェクトを作成します
   - このステップでは、Todoオブジェクトのプロパティを更新するために使用しています
</details>

## 📝 まとめ

このステップでは以下について学びました。

- **状態の更新**
  - 配列の要素の更新
  - オブジェクトのプロパティの更新
  - スプレッド演算子の使用

- **イベントハンドリング**
  - チェックボックスの状態変更イベント
  - イベントハンドラの実装

- **条件付きレンダリング**
  - 完了状態に応じたスタイルの適用
  - 条件付きクラス名の設定

---
