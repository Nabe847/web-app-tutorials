---
title: '7: タスクの更新/削除'
pubDate: 2025-06-09
description: 'Next.js の初心者向けチュートリアルです'
author: 'Nabe847'
image:
  url: 'https://docs.astro.build/assets/full-logo-light.png'
  alt: 'Astroのロゴ。'
tags: ['Next.js', 'tutorial']
---

import { Steps } from '@astrojs/starlight/components';

## このステップで学ぶこと

前回のタスク追加機能に続いて、今回はタスクの更新と削除機能を実装していきます。

以下の機能について学びます：
- タスクの完了状態の切り替え
- タスクの削除機能
- 確認ダイアログの表示
- 配列の操作（map, filter）
- 条件付きレンダリング
- 統計情報の表示

### app/page.js を更新

タスクの更新と削除機能を実装します：

```javascript
'use client';

import { useState } from 'react';

export default function Home() {
  const [tasks, setTasks] = useState([
    { id: 1, title: '買い物に行く', completed: false },
    { id: 2, title: '宿題をする', completed: true },
    { id: 3, title: '友達に連絡する', completed: false },
  ]);

  const [newTaskTitle, setNewTaskTitle] = useState('');

  // タスクを追加する関数
  const addTask = () => {
    if (newTaskTitle.trim() === '') {
      alert('タスクタイトルを入力してください');
      return;
    }

    const newTask = {
      id: Date.now(),
      title: newTaskTitle,
      completed: false,
    };

    setTasks([...tasks, newTask]);
    setNewTaskTitle('');
  };

  // タスクの完了状態を切り替える関数
  const toggleTask = (id) => {
    setTasks(
      tasks.map((task) =>
        task.id === id ? { ...task, completed: !task.completed } : task,
      ),
    );
  };

  // タスクを削除する関数
  const deleteTask = (id) => {
    if (window.confirm('このタスクを削除しますか？')) {
      setTasks(tasks.filter((task) => task.id !== id));
    }
  };

  return (
    <div style={{ padding: '20px', maxWidth: '600px', margin: '0 auto' }}>
      <h1>タスク管理アプリ</h1>

      <div style={{ marginBottom: '20px' }}>
        <h2>新しいタスクを追加</h2>
        <input
          type="text"
          value={newTaskTitle}
          onChange={(e) => setNewTaskTitle(e.target.value)}
          placeholder="タスクを入力してください"
          style={{
            padding: '8px',
            width: '300px',
            marginRight: '10px',
            border: '1px solid #ccc',
            borderRadius: '4px',
          }}
          onKeyPress={(e) => {
            if (e.key === 'Enter') {
              addTask();
            }
          }}
        />
        <button
          onClick={addTask}
          style={{
            padding: '8px 16px',
            backgroundColor: '#007bff',
            color: 'white',
            border: 'none',
            borderRadius: '4px',
            cursor: 'pointer',
          }}
        >
          追加
        </button>
      </div>

      <div>
        <h2>タスク一覧 ({tasks.length}件)</h2>
        {tasks.length === 0 ? (
          <p style={{ color: '#666', fontStyle: 'italic' }}>
            タスクがありません。上記から新しいタスクを追加してください。
          </p>
        ) : (
          tasks.map((task) => (
            <div
              key={task.id}
              style={{
                border: '1px solid #ccc',
                padding: '15px',
                margin: '10px 0',
                backgroundColor: task.completed ? '#f0f8f0' : '#fff',
                borderRadius: '4px',
              }}
            >
              <span
                style={{
                  textDecoration: task.completed ? 'line-through' : 'none',
                  fontSize: '16px',
                }}
              >
                {task.title}
              </span>
              <span
                style={{ marginLeft: '10px', fontSize: '12px', color: '#666' }}
              >
                {task.completed ? '完了' : '未完了'}
              </span>

              <div style={{ marginTop: '10px' }}>
                <button
                  onClick={() => toggleTask(task.id)}
                  style={{
                    marginRight: '5px',
                    padding: '4px 8px',
                    fontSize: '12px',
                    backgroundColor: task.completed ? '#ffc107' : '#28a745',
                    color: 'white',
                    border: 'none',
                    borderRadius: '3px',
                    cursor: 'pointer',
                  }}
                >
                  {task.completed ? '未完了にする' : '完了にする'}
                </button>
                <button
                  onClick={() => deleteTask(task.id)}
                  style={{
                    padding: '4px 8px',
                    fontSize: '12px',
                    backgroundColor: '#dc3545',
                    color: 'white',
                    border: 'none',
                    borderRadius: '3px',
                    cursor: 'pointer',
                  }}
                >
                  削除
                </button>
              </div>
            </div>
          ))
        )}
      </div>

      {/* 統計情報 */}
      <div
        style={{
          marginTop: '20px',
          padding: '15px',
          backgroundColor: '#f8f9fa',
          borderRadius: '4px',
        }}
      >
        <h3>統計</h3>
        <p>全タスク: {tasks.length}件</p>
        <p>完了: {tasks.filter((task) => task.completed).length}件</p>
        <p>未完了: {tasks.filter((task) => !task.completed).length}件</p>
      </div>
    </div>
  );
}
```

### コードの解説

<Steps>

1. **タスクの完了状態を切り替える関数**

   ```javascript
   const toggleTask = (id) => {
     setTasks(
       tasks.map((task) =>
         task.id === id ? { ...task, completed: !task.completed } : task,
       ),
     );
   };
   ```

   > 💡 **タスクの更新について**
   > - `map`メソッドを使用して配列の各要素を処理
   > - スプレッド演算子（`...`）で既存のタスクのプロパティをコピー
   > - 条件演算子（`?:`）で該当するタスクの`completed`プロパティを反転
   > - 該当しないタスクはそのまま返す

2. **タスクを削除する関数**

   ```javascript
   const deleteTask = (id) => {
     if (window.confirm('このタスクを削除しますか？')) {
       setTasks(tasks.filter((task) => task.id !== id));
     }
   };
   ```

   > 💡 **タスクの削除について**
   > - `window.confirm`で確認ダイアログを表示
   > - `filter`メソッドで指定されたID以外のタスクを抽出
   > - 新しい配列を`setTasks`で状態として設定

3. **条件付きレンダリング**

   ```javascript
   {tasks.length === 0 ? (
     <p style={{ color: '#666', fontStyle: 'italic' }}>
       タスクがありません。上記から新しいタスクを追加してください。
     </p>
   ) : (
     tasks.map((task) => (
       // タスクの表示
     ))
   )}
   ```

   > 💡 **条件付きレンダリングについて**
   > - 三項演算子（`?:`）を使用して条件分岐
   > - タスクが0件の場合はメッセージを表示
   > - タスクがある場合は一覧を表示

4. **統計情報の表示**

   ```javascript
   <div>
     <h3>統計</h3>
     <p>全タスク: {tasks.length}件</p>
     <p>完了: {tasks.filter((task) => task.completed).length}件</p>
     <p>未完了: {tasks.filter((task) => !task.completed).length}件</p>
   </div>
   ```

   > 💡 **統計情報について**
   > - `filter`メソッドで完了/未完了のタスクをカウント
   > - リアルタイムで統計情報が更新される
   > - スタイリングで視覚的に区別

</Steps>

### よくある問題と解決方法

**タスクの更新が反映されない場合**
- `toggleTask`関数が正しく呼び出されているか確認
- イベントハンドラの設定が正しいか確認
- コンソールにエラーが表示されていないか確認

**タスクの削除が機能しない場合**
- `deleteTask`関数が正しく呼び出されているか確認
- 確認ダイアログの表示が正しく機能しているか確認
- `filter`メソッドの条件が正しいか確認

### 🔍 動作確認

実装した機能が正しく動作するか確認してみましょう：

import ChecklistItem from '../../../components/ChecklistItem.jsx';

<div>
  <ChecklistItem client:load id="step5-point1">
    タスクの完了状態が切り替わる
  </ChecklistItem>
  <ChecklistItem client:load id="step5-point2">
    完了したタスクの表示が変わる
  </ChecklistItem>
  <ChecklistItem client:load id="step5-point3">
    削除時に確認ダイアログが表示される
  </ChecklistItem>
  <ChecklistItem client:load id="step5-point4">
    タスクが正しく削除される
  </ChecklistItem>
  <ChecklistItem client:load id="step5-point5">
    統計情報が正しく表示される
  </ChecklistItem>
  <ChecklistItem client:load id="step5-point6">
    タスクが0件の時にメッセージが表示される
  </ChecklistItem>
</div>

### 🎯 理解度チェッククイズ

以下の質問に答えて、学習内容を確認しましょう！

1. **配列の要素を更新するために使用するメソッドは？**

   - A: `filter`
   - B: `map`
   - C: `reduce`
   - D: `forEach`

   <details>
   <summary>答えを見る</summary>

   **答え: B: `map`**
   - `map`メソッドは配列の各要素を変換して新しい配列を作成します
   - タスクの更新には、`map`を使用して特定のタスクのプロパティを変更します
   </details>

2. **配列から要素を削除するために使用するメソッドは？**

   - A: `map`
   - B: `filter`
   - C: `splice`
   - D: `slice`

   <details>
   <summary>答えを見る</summary>

   **答え: B: `filter`**
   - `filter`メソッドは条件に合う要素だけを抽出して新しい配列を作成します
   - タスクの削除には、`filter`を使用して特定のID以外のタスクを抽出します
   </details>

3. **確認ダイアログを表示するために使用するメソッドは？**

   - A: `window.alert`
   - B: `window.prompt`
   - C: `window.confirm`
   - D: `window.dialog`

   <details>
   <summary>答えを見る</summary>

   **答え: C: `window.confirm`**
   - `window.confirm`はユーザーに確認を求めるダイアログを表示します
   - タスクの削除前に確認を取るために使用します
   </details>

---
