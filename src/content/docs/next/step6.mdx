---
title: '6: Todoの追加'
pubDate: 2025-06-09
description: 'Next.js の初心者向けチュートリアルです'
author: 'Nabe847'
image:
  url: 'https://docs.astro.build/assets/full-logo-light.png'
  alt: 'Astroのロゴ。'
tags: ['Next.js', 'tutorial']
---

## このステップで学ぶこと

前回はTodoの表示機能を実装しました。  
今回は新しいTodoを追加する機能を実装していきましょう。

1. **フォームの基本的な使い方**
2. **状態管理の方法**
3. **イベントハンドリング**

このステップでは、フォームを使った入力処理の基本を学びます。

## Todo追加機能の作成

`src/app/todos/page.js` を以下の内容に更新します。

```diff lang="jsx"
'use client';
import { useState } from 'react';
import style from './page.module.css';

export default function Todos() {
  // Todoデータの定義
  const [todos, setTasks] = useState([
    { id: 1, title: '買い物に行く', completed: false },
    { id: 2, title: 'メールを確認する', completed: false },
    { id: 3, title: '資料を作成する', completed: false },
    { id: 4, title: '友達に電話する', completed: false },
    { id: 5, title: '部屋の掃除', completed: false },
  ]);

+  // 1. 入力値の状態管理
+  const [newTask, setNewTask] = useState('');

+  // 2. Todoをリストに追加する
+  const handleSubmit = (e) => {
+    e.preventDefault();
+    if (newTask.trim() === '') return;
+
+    const newId = todos.length > 0 ? Math.max(...todos.map(t => t.id)) + 1 : 1;
+    setTasks([...todos, { id: newId, title: newTask, completed: false }]);
+    setNewTask('');
+  };

  return (
    <section className={style.container}>
      <h1>Todoリスト</h1>

+      {/* 3. Todo入力フォーム */}
+      <form className={style.form} onSubmit={handleSubmit}>
+        <input
+          type="text"
+          value={newTask}
+          onChange={(e) => setNewTask(e.target.value)}
+          placeholder="新しいTodoを入力"
+          className={style.input}
+        />
+        <button type="submit" className={style.button}>追加</button>
+      </form>

      {/* Todo一覧 */}
      <div className={style.checkbox}>
        {todos.map((task) => (
          <div key={task.id}>
            <label>
              <input type="checkbox" checked={task.completed} onChange={(e) => {console.log(e.target.checked)}} />
              {task.title}
            </label>
          </div>
        ))}
      </div>
    </section>
  );
}
```

## コードの解説

1. **状態管理の基本**
   - `useState` フックを使って、データを保存する場所（状態）を作ります
   - `todos`: Todo一覧を保存する配列
   - `newTask`: 入力フォームの文字を保存する変数

2. **Todoをリストに追加する**
   ```javascript
   const handleSubmit = (e) => {
     e.preventDefault();
     if (newTask.trim() === '') return;

     const newId = todos.length > 0 ? Math.max(...todos.map(t => t.id)) + 1 : 1;
     setTasks([...todos, { id: newId, title: newTask, completed: false }]);
     setNewTask('');
   };
   ```
   - `e.preventDefault()`: フォームの送信ボタンを押したときの、ページの更新を防ぎます
   - `newTask.trim()`: 入力された文字の前後の空白を削除します
   - `if (newTask.trim() === '') return`: 空のTodoは追加しないようにします
   - `todos.length > 0 ? ... : 1`: Todoが1つもない場合は1から始めます
   - `setTasks([...todos, { id: newId, title: newTask, completed: false }])`: 新しいTodoを配列に追加します
   - `setNewTask('')`: 入力フォームを空にします

3. **フォームの基本**
   ```jsx
      <form className={style.form} onSubmit={handleSubmit}>
        <input
          type="text"
          value={newTask}
          onChange={(e) => setNewTask(e.target.value)}
          placeholder="新しいTodoを入力"
          className={style.input}
        />
        <button type="submit" className={style.button}>追加</button>
      </form>
   ```
   - `onSubmit`: 追加ボタンが押されたときの処理を指定します  
   ここではTodoをリストに追加する処理を指定しています
   - `value`: テキストボックスに表示する値を指定します
   - `onChange`: テキストボックス内容が変わったときの処理を指定します  
   ここでは新しい値を保存しています
   - `placeholder`: 入力フォームが空のときに表示する説明を指定します

## スタイルの更新

`src/app/todos/page.module.css` に以下のスタイルを追加します。

```css
.form {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
}

.input {
  flex: 1;
  padding: 0.5rem;
  border: 1px solid #ccc;
  border-radius: 3px;
}

.button {
  padding: 0.5rem 1rem;
  background-color: #0070f3;
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
}

.button:hover {
  background-color: #0051a2;
}
```

## 🔍 確認

実装した機能が正しく動作しているか確認しましょう:

import ChecklistItem from '../../../components/ChecklistItem.jsx';

<div>
  <ChecklistItem client:load id="step6-point1">
    新しいTodoを追加できる
  </ChecklistItem>
  <ChecklistItem client:load id="step6-point2">
    追加ボタンをクリックするとTodoが追加される
  </ChecklistItem>
  <ChecklistItem client:load id="step6-point3">
    追加後に入力フィールドがクリアされる
  </ChecklistItem>
  <ChecklistItem client:load id="step6-point4">
    空のTodoは追加されない
  </ChecklistItem>
</div>

## よくある問題と解決方法

**フォームが送信されない**
- `preventDefault()` が正しく呼び出されているか確認
- フォームの `onSubmit` イベントが正しく設定されているか確認

**状態が更新されない**
- `useState` の初期値が正しく設定されているか確認
- 状態更新関数が正しく呼び出されているか確認

**スタイルが適用されない**
- CSSモジュールのインポートが正しいか確認
- クラス名の指定が正しいか確認

## 🎯 理解度チェック

以下の質問に答えて、学習内容を確認しましょう！

1. **Reactで状態を管理するために使用するフックは？**

   - A: `useEffect`
   - B: `useState`
   - C: `useContext`
   - D: `useReducer`

<details>
<summary>答えを見る</summary>

   **答え: B: `useState`**
   - `useState` はコンポーネント内で状態を管理するための基本的なフックです
   - 状態の値と、それを更新する関数のペアを返します
</details>

2. **フォームの送信を防止するために使用するメソッドは？**

   - A: `stopPropagation()`
   - B: `preventDefault()`
   - C: `stopImmediatePropagation()`
   - D: `cancelBubble()`

<details>
<summary>答えを見る</summary>

   **答え: B: `preventDefault()`**
   - `preventDefault()` はイベントのデフォルトの動作を防止します
   - フォームの送信時には、ページのリロードを防ぐために使用します
</details>

## 📝 まとめ

このステップでは以下について学びました。

- **フォームの基本**
  - 入力フィールドの作成
  - フォーム送信の処理
  - 入力値のバリデーション

- **状態管理**
  - `useState` フックの使用
  - 状態の更新方法
  - 配列の操作

- **イベントハンドリング**
  - フォーム送信イベント
  - 入力値の変更イベント
  - イベントのデフォルト動作の防止

--- 